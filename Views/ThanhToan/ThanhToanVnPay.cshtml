@{
    ViewData["Title"] = "Thanh toán bằng chuyển khoản";

    var bankId = "STB"; // Sacombank
    var accountNo = "050139411584";
    var template = "compact2";
    var amount = ViewBag.TongTien ?? 200000;
    var description = $"Thanh toan {amount:N0} cho don hang tren Website Chella";
    var accountName = "VO TRAN NGU";
    var qrUrl = $"https://img.vietqr.io/image/{bankId}-{accountNo}-{template}.png?amount={amount}&addInfo={Uri.EscapeDataString(description)}&accountName={Uri.EscapeDataString(accountName)}";

    string chiNhanh = "Chi nhánh TP.HCM";
    string tenNganHang = "SACOMBANK";
}
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="~/css/TrangChuStyle.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&family=Edu+VIC+WA+NT+Hand+Pre:wght@400..700&family=Pacifico&family=Quicksand:wght@300..700&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<div style="max-width: 800px; margin: auto; padding: 30px; border: 1px solid #ccc; border-radius: 10px; margin-top: 20px">
    <h2 style="color: #de5f94; font-size: 35px">Thanh toán bằng chuyển khoản</h2>

    <div style="text-align: center; font-size: 16px; margin-bottom: 15px;">
        <strong>Tổng tiền:</strong> @String.Format("{0:N0} VNĐ", amount) |
        <strong>Thời gian còn lại:</strong> <span id="countdown">05:00</span>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px;">
        <!-- QR Code -->
        <div style="flex: 1; text-align: center;">
            <img src="@qrUrl" alt="QR chuyển khoản" width="250" style="border: 1px solid #ccc; padding: 10px; border-radius: 10px;" />
            <p style="margin-top: 10px;"><strong>@accountName</strong><br />@accountNo<br /><small>Số tiền: @string.Format("{0:N0} VNĐ", amount)</small></p>
            <button onclick="window.history.back()" class="button-custom">
                ← Quay lại
            </button>
        </div>

        <!-- Hướng dẫn -->
        <div style="flex: 2;">
            <p><strong>Bước 1:</strong> Mở ứng dụng <strong>Mobile Banking</strong> của ngân hàng</p>
            <p><strong>Bước 2:</strong> Chọn <strong>“Thanh Toán”</strong> và quét mã QR bên trái</p>
            <p><strong>Bước 3:</strong> Nhập số tiền là <strong>@string.Format("{0:N0} VNĐ", amount)</strong> và nội dung chuyển khoản là:</p>
            <div style="margin-left: 20px; background-color: #f1f1f1; padding: 8px 12px; border-radius: 5px;">
                <code id="copyText">@description</code>
                <button onclick="copyToClipboard()" style="margin-left: 10px; padding: 2px 8px; font-size: 12px;">Copy</button>
            </div>
            <p><strong>Bước 4:</strong> Xác nhận chuyển khoản và đợi hệ thống xử lý đơn hàng</p>

            <hr />

            <p><strong>Ngân hàng:</strong> @tenNganHang</p>
            <p><strong>Chủ tài khoản:</strong> @accountName</p>
            <p><strong>Số tài khoản:</strong> @accountNo</p>
            <p><strong>Chi nhánh:</strong> @chiNhanh</p>
        </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center;">
        <form id="form-dat-hang" asp-action="DatHang" asp-controller="ThanhToan" method="post">
            <button type="submit" class="button-custom">Xác nhận đã thanh toán</button>
        </form>

    </div>


</div>

@section Scripts {
    <script>
        // Countdown Timer: 5 phút
        let duration = 300;// 5 phut
        const countdownEl = document.getElementById("countdown");

        const timer = setInterval(() => {
            let minutes = Math.floor(duration / 60);
            let seconds = duration % 60;
            countdownEl.textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (duration <= 0) {
                clearInterval(timer);
                countdownEl.textContent = "Vui lòng quay lại tạo mới QR";
            }
            duration--;
        }, 1000);

        // Copy nội dung chuyển khoản
        function copyToClipboard() {
            const text = document.getElementById("copyText").textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert("Đã sao chép nội dung chuyển khoản!");
            });
        }
    </script>
}
