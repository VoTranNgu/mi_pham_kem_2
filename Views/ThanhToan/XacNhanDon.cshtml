@model IEnumerable<mi_pham_kem.Models.SQLServer.GioHang>
@using mi_pham_kem.Models.SQLServer


<style>
    .card-box {
        background-color: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }


    .order-summary {
        border: 2px solid #de5f94;
        border-radius: 20px;
        padding: 20px;
        position: relative;
        margin-top: 20px;
    }

    .order-title {
        position: absolute;
        top: -20px;
        left: 20px;
        background: #fff;
        padding: 0 10px;
        font-size: 25px;
        font-weight: bold;
        color: #de5f94;
        font-family: 'Pacifico', cursive;
    }

    input {
        height: 50px;
        border: 2px solid #de5f94;
        border-radius: 25px;
        padding: 10px 15px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }

    p {
        margin: 5px;
    }
</style>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="~/css/TrangChuStyle.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&family=Edu+VIC+WA+NT+Hand+Pre:wght@400..700&family=Pacifico&family=Quicksand:wght@300..700&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <h2 style="margin:20px">Xác nhận đơn hàng</h2>
    <br />
    <div class="container">
        <div class="row">
            <div class="col-md-6" style="padding: 5px">
                <h3 style="font-size: 25px;font-weight: bold;color: #de5f94; text-align:center">
                    Thông tin đơn hàng
                </h3>
                <br />
                <div class="card-box">
                    <p><strong>Sản phẩm đã chọn</strong></p>
                    <br />
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ảnh</th>
                                <th>Sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Giá</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        <img src="@item.MaSanPhamNavigation?.HinhAnh" width="80" height="80" alt="ảnh sản phẩm" />
                                    </td>
                                    <td style="max-width: 200px; word-wrap: break-word; white-space: normal;">
                                        @item.MaSanPhamNavigation?.TenSanPham
                                    </td>
                                    <td>
                                        <span style="min-width: 30px; text-align: center;">@item.SoLuong</span>
                                    </td>
                                    <td>
                                        @(item.MaSanPhamNavigation?.Gia != null
                                                                            ? String.Format("{0:0,0}đ", item.MaSanPhamNavigation.Gia)
                                                                            : "")


                                </td>
                            </tr>
                                                        }

                        </tbody>
                    </table>
                    <br />
                </div>

                <div class="card-box">
                    <p><strong>Mã áp dụng (Áp dụng tối đa 1 mã giảm giá):</strong></p>
                    @if (ViewBag.MaUuDai != null)
                    {
                        <p style="font-weight: bold; color: #28a745">@ViewBag.MaUuDai</p>
                    }
                    else
                    {
                        <form asp-action="ApDungUuDaiTaiXacNhan" method="post">
                            <div class="row">
                                <div class="col-8">
                                    <input type="text" name="maUuDai" placeholder="Nhập mã giảm giá"
                                           class="form-control" style="border: 1px solid #de5f94; border-radius: 12px;" />
                                </div>
                                <div class="col-4">
                                    <button type="submit" class="button-custom">Áp dụng</button>
                                </div>
                            </div>
                        </form>
                    }
                    @if (TempData["LoiUuDai"] != null)
                    {
                        <div class="alert alert-danger mt-2">@TempData["LoiUuDai"]</div>
                    }
                    @if (TempData["ThongBaoUuDai"] != null)
                    {
                        <div class="alert alert-success mt-2">@TempData["ThongBaoUuDai"]</div>
                    }

                </div>


                <hr />
                <div style="border: 2px solid red; padding: 16px; border-radius: 12px; width: fit-content;">
                    <div style="display: flex; align-items: center;">
                        <img src="~/lib/image/warning.png" alt="icon" style="width: 24px; height: 24px; margin-right: 8px;">
                        <label style="color: red; font-weight: bold">Lưu ý : Tuyệt đối không chuyển khoản cho shipper trước khi nhận hàng</label><br>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px">
                    <a href="~/GioHang/GioHang" class="button-custom" style="text-decoration: none;">← Quay về giỏ hàng</a>

                </div>

            </div>
            <div class="col-md-6">
                <div class="order-summary">
                    <div class="order-title">
                        <span>Đơn hàng của bạn</span>
                    </div>
                    <div class="order-body">
                        <p>Tạm tính: <stronng>@string.Format("{0:N0} đ", ViewBag.TongTien)</stronng></p>
                        <p style="margin-top:10px">Giảm giá: <strong>@string.Format("{0:N0} đ", ViewBag.GiaGiam ?? 0)</strong></p>
                        <p>Phí vận chuyển: 30,000 đ</p>
                        <hr />
                        <p style="color: #de5f94; font-weight: bold; font-size: 17px">
                            Tổng giá: <strong>@string.Format("{0:N0} đ", (ViewBag.TongTien ?? 0) - (ViewBag.GiaGiam ?? 0) + 30000)</strong>
                        </p>
                    </div>
                </div>
                <div class="card-box" style="margin-top:20px">
                    <form id="form-dat-hang" asp-action="DatHang" asp-controller="ThanhToan" method="post">
                        <p><strong>Phương thức thanh toán</strong></p>

                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <input type="radio" id="cod" name="paymentMethod" value="cod" checked />
                            <label for="cod" style="margin-left: 8px;">Thanh toán khi nhận hàng</label>
                            <img src="~/lib/image/currency-note.png" style="width: 24px; height: 24px; margin-left: 10px;" />
                        </div>

                        <div style="display: flex; align-items: center;">
                            <input type="radio" id="online" name="paymentMethod" value="payos" />
                            <label for="online" style="margin-left: 8px;">Thanh toán trực tuyến</label>
                            <img src="~/lib/image/qr.png" style="width: 24px; height: 24px; margin-left: 10px;" />
                        </div>

                        <br />
                        <button class="button-custom" type="submit">Xác nhận đặt hàng</button>
                    </form>

                </div>
                <div class="card-box" style="margin-top:20px">
                    <p><strong>Thông tin nhận hàng (mặc định): </strong></p>
                    <label style="margin-top: 10px">Địa chỉ nhận hàng: @ViewBag.DiaChi</label>
                    <br />
                    <label style="margin-top: 10px">Số điện thoại nhận hàng: @ViewBag.SoDienThoai</label>
                    <div style="text-align:center; margin-top:10px">
                        <a href="/TaiKhoan/SuaThongTin" class="button-custom">Cập nhật thông tin</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            $('#form-dat-hang').submit(function (e) {
                e.preventDefault();

                var selected = $('input[name="paymentMethod"]:checked').val();
                if (selected === 'cod') {
                    this.submit();
                } else if (selected === 'payos') {
                    window.location.href = '/ThanhToan/ThanhToanPayOS';
                }
            });
        });
    </script>


</body>